## Django URL Shortener

Developed with Python 3.12.2

A Django application for creating a shortened URL.

For example, you have a URL like this: https://www.example.com/a-really-long-path-here

This app will shorten it to something like: http://127.0.0.1/G7dt9mY (of course the protocol and domain may differ in your scenario).

Redis caching is utilized for the shortened URL and the timeout can be adjusted in .env.

ClickHouse and Celery/RabbitMQ are used to implement click tracking.

### Installation

These steps will guide you through setting up this app using the minimum requirements.

#### 1. Clone this repo

Clone this repo into a directory where you would like to store the source files.

```bash
git clone giturl
```

Replace "giturl" with the actual git URL of this repo.

#### 2. Copy .env.sample to .env and configure

Navigate into the project directory:

```bash
cd django-url-shortener
```

Copy .env.sample to .env:

```bash
cp .env.sample .env
```

Open .env in your favorite text editor and configure the variables. At the very minimum, you will need to set a DJANGO_SECRET_KEY. You may use the secret key generator script in this project:

```bash
python3 secret_key_generator.py
```

Comment out the DJANGO_SUPERUSER_USERNAME, DJANGO_SUPERUSER_EMAIL, and DJANGO_SUPERUSER_PASSWORD variables if you want to create a Django superuser manually.

The remaining variables are set for local testing and development but any passwords and usernames would need to be changed for production environments.

#### 3. Launch the Docker containers

This step assumes you have Docker and Docker Compose installed.

Run the following to build and launch the containers:

```bash
docker-compose build
docker-compose up -d
```

Use the `docker ps` command to check if the containers launched and are running without crashing.

#### 4. Create a Django superuser

This only applies if the DJANGO_SUPERUSER_USERNAME, DJANGO_SUPERUSER_EMAIL, and DJANGO_SUPERUSER_PASSWORD .env variables were commented out in step #2.

Run the following to create a Django superuser:

```bash
docker exec -it django-app python manage.py createsuperuser
```

#### 5. Run tests

TODO

#### 6. Run application

At this point you should then be able to access http://127.0.0.1/ in a browser and see form for creating a shortened URL.

The admin area is located at http://127.0.0.1/admin .

#### 7. Create some captcha questions and answers

Log into the admin area and navigate to "Captchas" under "Main" on the left. Create several question and answers.

### API Documentation

An API key is required for all endpoints. API keys may be generated in the admin area by navigating to "API keys" under "API" on the left. An admin-only API key may be generated by ticking the "Is admin" box when creating a new key.

#### GET /api/paths/

Get all short codes, destination URLs, and short URLs.

Available for admin API Keys only.

Example request:
```bash
curl -X GET http://127.0.0.1/api/paths/ \
     -H "Authorization: Api-Key YOUR_API_KEY"
```

Example response:
```json
[{"short_code":"RdpYqPT","dest_url":"https://example.com/test1","short_url":"http://127.0.0.1/RdpYqPT"},{"short_code":"oDr9JOs","dest_url":"https://example.com/test2","short_url":"http://127.0.0.1/oDr9JOs"}]
```

#### POST /api/shorten/

Shorten a URL.

Available for both admin and non-admin API keys.

Example request:
```bash
curl -X POST http://127.0.0.1/api/shorten/ \
     -H "Authorization: Api-Key YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{"dest_url": "https://example.com"}'
```

Example response:
```json
{"short_code":"RNw07TE","dest_url":"https://example.com","short_url":"http://127.0.0.1/RNw07TE"}
```

#### GET /api/resolve/{short_code}/

Get the destination URL by short_code.

Available for both admin and non-admin API keys.

Example request:
```bash
curl -X GET http://127.0.0.1/api/resolve/RNw07TE/ \
     -H "Authorization: Api-Key YOUR_API_KEY"
```

Example response:
```json
{"dest_url":"https://example.com"}
```

#### GET /api/stats/{short_code}/

Get stats for a shortened URL by short_code.

Available for both admin and non-admin API keys, however non-admin API keys may only retrieve stats for their own shortened URLs. Stats for shortened URLs created in the web UI can only be access by admin API keys.

Example request:
```bash
curl -X GET http://127.0.0.1:8000/api/stats/RNw07TE/ \
     -H "Authorization: Api-Key YOUR_API_KEY"
```

Example response:
```json
{"short_code":"RNw07TE","total_clicks":3,"unique_visitors":1,"last_visited":"2025-02-09T03:49:27"}
```

### Roadmap

- App improvements:
  - Decouple frontend with a JavaScript framework (react, next, express, ?)
  - Allow anonymous users to create API keys (restrict by IP? require email verification?)
  - Add API request rate limiting
  - Automatically load some starting captcha question and answers into the database
- Documentation:
  - Document running tests with the new Docker setup
  - Component diagram for README
  - Troubleshooting section with helpful commands
- Code cleanups:
  - Docstrings where applicable
  - Type hints
